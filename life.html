<!DOCTYPE html>
<html>
  <head>
    <title>Life</title>
    <style type='text/css'>
      html, body {
        margin: 0px;
        padding: 0px;
        background-color: #000;
        font-family: 'Trebuchet MS', Arial, sans-serif;
      }

      #controls {
        position: fixed;
        top: 10px !important;
        left: 10px !important;
        background-color: #000;
        color: #FFF;
        margin: 0px;
        opacity: 0.2;
      }

      #controls:hover {
        opacity: 1.0;
      }
    </style>
  </head>
  <body>
    <canvas id='life'></canvas>
    <div id='controls'>
      FPS: <input type='number' id='speed' value='30' />
      <input type='button' id='startstop' value='Start' />
      <br />
      Generation: <span id='generation'>0</span>
    </div>
    <script type='text/javascript' src='life.js'></script>
    <script type='text/javascript'>
      var running = false
      var _int = null
      var generation = 0
      var CELL_SIZE = 5

      var shape = 'rectangle'

      var life = new Life(parseInt(window.innerWidth / CELL_SIZE) - 1, parseInt(window.innerHeight / CELL_SIZE) - 1)

      var canvas = document.getElementById('life')
      canvas.width = life.width * CELL_SIZE
      canvas.height = life.height * CELL_SIZE
      canvas.style.backgroundColor = 'black'

      document.body.style.marginLeft = parseInt((window.innerWidth - life.width * CELL_SIZE) / 2).toString() + 'px'

      document.body.style.marginTop = parseInt((window.innerHeight - life.height * CELL_SIZE) / 2 - 1).toString() + 'px'

      var ctx = canvas.getContext('2d')

      life.onUpdate = function (x, y) {
        var state = life.grid[y][x]

        if (state) {
          ctx.fillStyle = 'rgb(238, 238, 238)'
        }
        else {
          ctx.fillStyle = 'rgb(17, 17, 17)'
        }

        if (shape == 'rectangle') {
          ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE)
        }
        else if (shape == 'circle') {
          var cx = x * CELL_SIZE + CELL_SIZE / 2,
              cy = y * CELL_SIZE + CELL_SIZE / 2
          
          ctx.beginPath()
          ctx.arc(cx, cy, CELL_SIZE / 2, 0, 2 * Math.PI, false)
          ctx.fill()
        }
      }

      document.getElementById('startstop').onclick = function () {
        if (running) {
          document.getElementById('startstop').value = 'Start'
          running = false
          clearInterval(_val)
        }
        else {
          document.getElementById('startstop').value = 'Stop'
          running = true
          _val = setInterval(function(){
            generation++
            life.step()
            document.getElementById('generation').innerText = generation
          }, 1000 / parseInt(document.getElementById('speed').value))
        }
      }

      canvas.addEventListener('click', function (event) {
        var x = event.pageX - canvas.offsetLeft,
            y = event.pageY - canvas.offsetTop
        
        life.setCell(parseInt(x / CELL_SIZE), parseInt(y / CELL_SIZE))
        life.flush()
      })

      function reset() {
        generation = 0

        life.reset()

        var mx = parseInt(life.width / 2),
            my = parseInt(life.height / 2)

        life.setCell(mx, my-1, true)
        life.setCell(mx+1, my, true)
        life.setCell(mx+1, my+1, true)
        life.setCell(mx, my+1, true)
        life.setCell(mx-1, my+1, true)

        life.flush()
      }

      reset()
    </script>
  </body>
</html>